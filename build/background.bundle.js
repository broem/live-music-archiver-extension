(()=>{"use strict";let e=0,t=0,o=0,r=0;function c(e,t){if(0==e.length)return 0;for(var o=[0],r=1;r<e.length;r++){for(var c=o[r-1];c>0&&e.charAt(r)!=e.charAt(c);)c=o[c-1];e.charAt(r)==e.charAt(c)&&c++,o.push(c)}for(c=0,r=0;r<t.length;r++){for(;c>0&&t.charAt(r)!=e.charAt(c);)c=o[c-1];if(t.charAt(r)==e.charAt(c)&&++c==e.length)return r-(c-1)}return-1}fetch("./config.json").then((e=>e.json())).then((e=>{chrome.storage.session.set({config:e},(function(){console.log("config data set to local storage"),console.log("checking user"),console.log("check user"),chrome.storage.session.get(["userId"],(function(e){console.log(e)}))}))})),chrome.action.onClicked.addListener((()=>{chrome.tabs.create({url:chrome.runtime.getURL("popup.html"),active:!1},(async function(e){console.log("tab created"),await chrome.windows.create({tabId:e.id,type:"popup",focused:!0,height:628,width:628}).then((()=>{popUpTabId=e.id})).catch((e=>{console.log(e)}))})),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){e.forEach((e=>{null!=e.url&&null!=e.url&&e.url.length>0&&-1==c("chrome",e.url)&&chrome.scripting.executeScript({target:{tabId:e.id},files:["./selectElements.js"]}).then((()=>{console.log("selectElements.js injected")})).catch((e=>{console.error(e)}))}))})),chrome.identity.getProfileUserInfo({accountStatus:"ANY"},(function(e){console.log("checking user info"),chrome.storage.session.set({userId:e.id}),chrome.storage.session.set({userEmail:e.email}),console.log("getting user"),async function(){console.log("dededeee user"),await async function(){chrome.storage.session.get(["userEmail","config","userId"],(async function(e){var t=e.config,o=e.userEmail,r={user_id:e.userId,email:o},c="http://"+t["remote-address"]+"/api/user";await fetch(c,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{Authorization:"Bearer null","Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{chrome.storage.session.set({user:JSON.stringify(e)})})).catch((e=>{console.log(e)}))}))}().then((e=>{console.log(e)})).catch((e=>{console.log(e)}))}()}))})),chrome.tabs.onUpdated.addListener((function(e,t,o){null!=o.url&&null!=o.url&&o.url.length>0&&-1==c("chrome",o.url)&&chrome.scripting.executeScript({target:{tabId:o.id},files:["selectElements.js"]})})),chrome.runtime.onInstalled.addListener((()=>{})),chrome.contextMenus.onClicked.addListener((function(e,t){if("BRING_BACK_POP"!==e.menuItemId)return;chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.scripting.executeScript({target:{tabId:e[0].id},files:["bringBackPopContext.js"]})}))})),chrome.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"}),chrome.runtime.onMessage.addListener((async function(n,s,a){if("Select elements"===n.selectElements){console.log("select elements"),e+=1;let t={field:n.field,label:n.label,updator:e};chrome.storage.sync.set({selectElements:JSON.stringify(t)})}if("removeElement"===n.msg){e+=1;let t={field:n.field,updator:e};chrome.storage.sync.set({removeElement:JSON.stringify(t)})}if("openTab"===n.msg&&chrome.tabs.create({url:n.url}).then((e=>{console.log("tab created"),chrome.scripting.executeScript({target:{tabId:e.id},files:["selectElements.js"]})})),"highlightElements"===n.msg){console.log("highlight elements"),chrome.storage.sync.get(["highlightElements"],(function(e){elems=JSON.parse(e),t=elems.updator})),t+=1;let e={highlightElements:n.data,updator:t};chrome.storage.sync.set({highlightElements:JSON.stringify(e)})}"Select all tagged elements"===n.selectAllTaggedElements&&(o+=1,chrome.storage.sync.set({selectAllIndex:o})),"Disable select"===n.disableSelect&&(r+=1,chrome.storage.sync.set({disableSelect:r})),"GetIGScrapes"===n.msg&&await async function(){chrome.storage.session.get(["userId","config"],(async function(e){var t=e.config;await fetch("http://"+t["remote-address"]+"/api/getCurrentIGScrapeEvents/"+e.userId,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{Authorization:"Bearer null","Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer"}).then((e=>e.json())).then((e=>{chrome.storage.session.set({scrapeIGEvents:e})})).catch((e=>{console.log(e)}))}))}(),"updateIGScrape"===n.msg&&await async function(e){chrome.storage.session.get("config",(async function(t){const o=t.config;await fetch("http://"+o["remote-address"]+"/api/updateIGScrape",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{Authorization:"Bearer null","Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}))}(n.data),"deleteIGScrape"===n.msg&&await async function(e){chrome.storage.session.get("config",(async function(t){const o=t.config;await fetch("http://"+o["remote-address"]+"/api/deleteIGScrape",{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{Authorization:"Bearer null","Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{})).catch((e=>{console.log(e)}))}))}(n.data),"Bring back scrape builder"===n.msg&&chrome.tabs.query({},(async function(e){var t=0;e.forEach((o=>{-1!=c("scrapeBuilder",o.url)&&chrome.windows.update(e[t].windowId,{focused:!0}),t++}))})),"Bring back popup"===n.msg&&(chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(e){var t=e[0];chrome.tabs.remove(t.id)})),chrome.tabs.create({url:chrome.runtime.getURL("popup.html"),active:!1},(async function(e){await chrome.windows.create({tabId:e.id,type:"popup",focused:!0,height:628,width:628})})),r+=1,chrome.storage.sync.set({disableSelect:r})),"Bring up active tab"===n.msg&&chrome.tabs.query({active:!0,currentWindow:!1},(async function(e){var t=0;e.forEach((o=>{-1!=c(s.url,o.url)&&chrome.windows.update(e[t].windowId,{focused:!0}),t++}))}))}))})();