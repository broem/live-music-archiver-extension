(()=>{"use strict";let e=0,t=0,o=0,s=0;function r(e,t){if(0==e.length)return 0;for(var o=[0],s=1;s<e.length;s++){for(var r=o[s-1];r>0&&e.charAt(s)!=e.charAt(r);)r=o[r-1];e.charAt(s)==e.charAt(r)&&r++,o.push(r)}for(r=0,s=0;s<t.length;s++){for(;r>0&&t.charAt(s)!=e.charAt(r);)r=o[r-1];if(t.charAt(s)==e.charAt(r)&&++r==e.length)return s-(r-1)}return-1}fetch("./config.json").then((e=>e.json())).then((e=>{chrome.storage.session.set({config:e},(function(){console.log("config data set to local storage"),console.log("checking user"),console.log("check user"),chrome.storage.session.get(["userId"],(function(e){console.log(e)}))}))})),chrome.action.onClicked.addListener((()=>{chrome.tabs.create({url:chrome.runtime.getURL("popup.html"),active:!1},(async function(e){console.log("tab created"),await chrome.windows.create({tabId:e.id,type:"popup",focused:!0,height:628,width:628}).then((()=>{popUpTabId=e.id})).catch((e=>{console.log(e)}))})),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){e.forEach((e=>{null!=e.url&&null!=e.url&&e.url.length>0&&-1==r("chrome",e.url)&&chrome.scripting.executeScript({target:{tabId:e.id},files:["./selectElements.js"]}).then((()=>{console.log("selectElements.js injected")})).catch((e=>{console.error(e)}))}))})),chrome.identity.getProfileUserInfo({accountStatus:"ANY"},(function(e){console.log("checking user info"),chrome.storage.session.set({userId:e.id}),chrome.storage.session.set({userEmail:e.email}),console.log("getting user"),async function(){console.log("dededeee user"),await async function(){chrome.storage.session.get(["userEmail","config","userId"],(async function(e){var t=e.config,o=e.userEmail,s={user_id:e.userId,email:o},r="http://"+t["remote-address"]+"/api/user";await fetch(r,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{Authorization:"Bearer null","Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(s)}).then((e=>e.json())).then((e=>{chrome.storage.session.set({user:JSON.stringify(e)})})).catch((e=>{console.log(e)}))}))}().then((e=>{console.log(e)})).catch((e=>{console.log(e)}))}()}))})),chrome.tabs.onUpdated.addListener((function(e,t,o){null!=o.url&&null!=o.url&&o.url.length>0&&-1==r("chrome",o.url)&&chrome.scripting.executeScript({target:{tabId:o.id},files:["selectElements.js"]})})),chrome.runtime.onInstalled.addListener((()=>{})),chrome.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"}),chrome.runtime.onMessage.addListener((async function(c,n,l){if("Select elements"===c.selectElements){console.log("select elements"),e+=1;let t={field:c.field,label:c.label,updator:e};chrome.storage.sync.set({selectElements:JSON.stringify(t)})}if("removeElement"===c.msg){e+=1;let t={field:c.field,updator:e};chrome.storage.sync.set({removeElement:JSON.stringify(t)})}if("openTab"===c.msg&&chrome.tabs.create({url:c.url}).then((e=>{console.log("tab created"),chrome.scripting.executeScript({target:{tabId:e.id},files:["selectElements.js"]})})),"highlightElements"===c.msg){console.log("highlight elements"),chrome.storage.sync.get(["highlightElements"],(function(e){elems=JSON.parse(e),t=elems.updator})),t+=1;let e={highlightElements:c.data,updator:t};chrome.storage.sync.set({highlightElements:JSON.stringify(e)})}"Select all tagged elements"===c.selectAllTaggedElements&&(o+=1,chrome.storage.sync.set({selectAllIndex:o})),"Disable select"===c.disableSelect&&(s+=1,chrome.storage.sync.set({disableSelect:s})),"Bring back scrape builder"===c.msg&&chrome.tabs.query({},(async function(e){var t=0;e.forEach((o=>{-1!=r("scrapeBuilder",o.url)&&chrome.windows.update(e[t].windowId,{focused:!0}),t++}))})),"Bring back popup"===c.msg&&(chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(e){var t=e[0];chrome.tabs.remove(t.id)})),chrome.tabs.create({url:chrome.runtime.getURL("popup.html"),active:!1},(async function(e){await chrome.windows.create({tabId:e.id,type:"popup",focused:!0,height:628,width:628})})),s+=1,chrome.storage.sync.set({disableSelect:s})),"Bring up active tab"===c.msg&&chrome.tabs.query({active:!0,currentWindow:!1},(async function(e){var t=0;e.forEach((o=>{-1!=r(n.url,o.url)&&chrome.windows.update(e[t].windowId,{focused:!0}),t++}))}))}))})();